\documentclass[11pt, a4paper]{article}

% --- FONT SETTINGS (Arial/Helvetica) ---
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage[scaled]{helvet} 
\renewcommand{\familydefault}{\sfdefault} 
% ---------------------------------------

% --- PACKAGES ---
\usepackage{graphicx}               
\usepackage[a4paper, margin=1in]{geometry}   
\usepackage{tikz}                   
\usepackage{listings}               
% REMOVED [table] option to prevent conflict with nicematrix
\usepackage{xcolor}          
\usepackage{nicematrix} % <--- Fixes table rendering on Linux
\usepackage{tcolorbox}  % <--- Creates rounded inline code
\usepackage{booktabs}               
\usepackage{subcaption}             
\usepackage{caption}                
\usepackage{needspace}              
\usepackage{float}                  
\usepackage[skip=10pt]{caption}     
\usepackage{fancyhdr}               
\usepackage{datetime}               
\usepackage{lipsum}                 
\usepackage{changepage}             
\usepackage[shortlabels]{enumitem}  
\usepackage{titletoc}  
\usetikzlibrary{calc}               

\setlength{\parindent}{0pt}         

% ==========================================
%      IMPORT PROJECT DETAILS (VARIABLES)
% ==========================================
\input{details}
% ==========================================

% --- COLOR DEFINITIONS ---
\definecolor{codebg}{RGB}{250, 245, 230}       % Aged Paper   
\definecolor{codegreen}{rgb}{0,0.5,0}      
\definecolor{codegray}{rgb}{0.5,0.5,0.5}   
\definecolor{framecolor}{rgb}{0.8,0.8,0.8} 
% FIX: Changed rgb to RGB (30 is invalid for lowercase rgb)
\definecolor{gray}{RGB}{30, 30, 30} 
\definecolor{inlinecodebg}{RGB}{240, 230, 200} % Darker Manila

% --- INTERACTIVITY (HYPERREF) ---
\usepackage{hyperref}
\hypersetup{
    colorlinks=true,      
    linkcolor=gray,       
    citecolor=gray,       
    filecolor=gray,       
    urlcolor=blue,        
    pdftitle={\docHeaderTitle},  
    pdfauthor={\authorName}      
}

% --- DATE FORMAT SETUP ---
\newdateformat{daymonyearformat}{\THEDAY\ \monthname[\THEMONTH] \THEYEAR}

% --- LISTINGS STYLES ---
\lstdefinestyle{mystyle}{
    language=R,
    backgroundcolor=\color{codebg},   
    basicstyle=\footnotesize\sffamily, 
    breakatwhitespace=false,         
    breaklines=true,               
    captionpos=b,                    
    keepspaces=true,                 
    numbers=none,                    
    numbersep=5pt,                  
    showspaces=false,                 
    showstringspaces=false,
    showtabs=false,                  
    tabsize=2,
    xleftmargin=15pt,
    framexleftmargin=15pt,
    frame=single,                    
    rulesepcolor=\color{framecolor}, 
    framerule=1pt,                   
    commentstyle=\color{codegray},   
    stringstyle=\color{codegreen},       
    otherkeywords={TRUE,FALSE,NA,Inf,NaN,NULL}
}

% --- CAPTION SETUP ---
\DeclareCaptionFormat{mycustomformat}{%
    \parbox{\linewidth}{
        \textbf{\MakeUppercase{\figurename}~\thefigure}\par%
        \vspace{0.5ex}      
        \small#3%
    }%
}

\DeclareCaptionStyle{mycustom}{
    format=mycustomformat,
    font=small,
    labelfont=bf,
    justification=raggedright,
    singlelinecheck=false
}

% --- CUSTOM INLINE COMMAND (CORRECTED) ---
\newtcbox{\inlinecode}{
  on line,           % Keeps the box on the same line as text
  arc=3pt,           % Rounded corners
  colback=inlinecodebg, 
  colframe=inlinecodebg, 
  boxrule=0pt,       % No thick border line
  boxsep=0pt,        % Minimize internal spacing
  left=3pt,          % Left padding
  right=3pt,         % Right padding
  top=2pt,           % Top padding (prevents text from hitting the ceiling)
  bottom=1pt,        % Bottom padding
  fontupper=\ttfamily % Sets the font to typewriter style
}

% --- HEADER AND FOOTER SETUP ---
\fancypagestyle{mainpages}{
    \fancyhf{}                      
    \fancyhead[L]{\small\textcolor{gray}{\docID \ | \ \docHeaderTitle}} 
    \fancyfoot[L]{\small\textcolor{gray}{\daymonyearformat\today}}   
    \fancyfoot[R]{\small\thepage}                                    
    \renewcommand{\headrulewidth}{0pt}
    \renewcommand{\footrulewidth}{0pt}
}

% --- TABLE OF CONTENTS / LISTS CUSTOMIZATION (FIXED) ---
% 1. Standardize Headers
\makeatletter
\renewcommand\tableofcontents{%
  \section*{\contentsname}
  \@starttoc{toc}%
}
\renewcommand\listoftables{%
  \section*{\listtablename}
  \@starttoc{lot}%
}
\renewcommand\listoffigures{%
  \section*{\listfigurename}
  \@starttoc{lof}%
}
\makeatother

% 2. SECTION Styles (TOC)
% Removed \MakeUppercase to fix the "invisible text" bug
\titlecontents{section}[2.3em]
  {\addvspace{1em}}                   
  {\bfseries\contentslabel{2em}}      
  {\hspace*{-2.3em}\bfseries}         
  {\titlerule*[0.3pc]{.}\contentspage}

\titlecontents{subsection}[4.6em] 
  {}
  {\contentslabel{2.3em}}
  {\hspace*{-2.3em}}
  {\titlerule*[0.3pc]{.}\contentspage}

\titlecontents{subsubsection}[6.9em]
  {}
  {\itshape\contentslabel{3em}}
  {\hspace*{-3em}}
  {\titlerule*[0.3pc]{.}\contentspage}

% 3. FIGURE List Styles (LOF)
\titlecontents{figure}[2.5em]
  {} 
  {\contentslabel{2.5em}}             
  {\hspace*{-2.5em}}
  {\titlerule*[0.3pc]{.}\contentspage}

% 4. TABLE List Styles (LOT)
\titlecontents{table}[2.5em]
  {}
  {\contentslabel{2.5em}}             
  {\hspace*{-2.5em}}
  {\titlerule*[0.3pc]{.}\contentspage}

% --- OVERRIDES ---
\renewcommand{\lstlistingname}{Code block} 
\lstset{style=mystyle} 

\pdfpageattr {/Group << /S /Transparency /I true /CS /DeviceRGB>>}

\begin{document}
% 1. Title Page
\input{titlepage}   

% 2. Front Matter (Lists) - Numbering: i, ii, iii
\pagenumbering{roman}

\ifShowTOC
    \tableofcontents
    \clearpage
\fi

\ifShowLOT
    % Now automatically styled correctly by the customization block above
    \addcontentsline{toc}{section}{Tables}
    \listoftables
    \clearpage
\fi

\ifShowLOF
    \addcontentsline{toc}{section}{Figures}
    \listoffigures
    \clearpage
\fi

% 3. Main Content - Numbering: 1, 2, 3
\pagenumbering{arabic}
\pagestyle{mainpages} % Activates the custom headers/footers

\include{content}    

\end{document}